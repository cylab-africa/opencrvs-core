apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: dashboards
  name: dashboards
spec:
  replicas: {{ .Values.dashboards.replicas }}
  selector:
    matchLabels:
      app: dashboards
  template:
    metadata:
      labels:
        app: dashboards
    spec:
      containers:
        - name: dashboards
          image: "opencrvs/ocrvs-dashboards:{{ .Values.image.tag }}"
          env:
            - name: OPENCRVS_METABASE_SITE_NAME
              value: OpenCRVS Dashboards
            - name: OPENCRVS_METABASE_SITE_URL
              value: {{ .Values.dashboards.openMetabaseSiteUrl }}
            - name: OPENCRVS_METABASE_DB_HOST
              value: {{ .Values.mongoUrl }}
            - name: OPENCRVS_METABASE_DB_USER
              value: performance
            - name: OPENCRVS_METABASE_DB_PASS
              value: test
            - name: OPENCRVS_METABASE_DB_AUTH_DB
              value: performance
            - name: OPENCRVS_METABASE_MAP_NAME
              value: Upanzi
            - name: OPENCRVS_METABASE_MAP_URL
              value: countryconfig.opencrvs-services-dev.svc.cluster.local:3040/content/map.geojson
            - name: OPENCRVS_METABASE_MAP_REGION_KEY
              value: state
            - name: OPENCRVS_METABASE_MAP_REGION_NAME
              value: State
            - name: OPENCRVS_METABASE_ADMIN_EMAIL
              value: semmanue@andrew.cmu.edu
            - name: OPENCRVS_METABASE_ADMIN_PASSWORD
              value: password
          command: ["/bin/sh", "/run-dev.sh"] # FIXME: make generic and provide run-dev.sh as args, not overwriting entrypoint
      restartPolicy: Always
